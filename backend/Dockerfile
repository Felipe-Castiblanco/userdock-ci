FROM php:8.2-apache

# ============================
# ğŸš€ Inicio Build Backend
# ============================
RUN echo "" \
    && echo "===== ğŸš€ Inicio Build Backend =====" \
    && echo ""

# ----------------------------
# ğŸ“¦ Instalando dependencias PHP
# ----------------------------
RUN echo "" \
    && echo "=> ğŸ“¦ Instalando dependencias PHP..." \
    && apt-get update && apt-get install -y --no-install-recommends \
        libzip-dev zip unzip git libpng-dev libjpeg-dev libfreetype6-dev \
    && docker-php-ext-configure gd --with-freetype --with-jpeg \
    && docker-php-ext-install pdo pdo_mysql gd zip \
    && a2enmod rewrite headers \
    && rm -rf /var/lib/apt/lists/* \
    && echo "" \
    && echo "âœ” Dependencias PHP instaladas âœ…" \
    && echo ""

# ----------------------------
# ğŸ”§ ConfiguraciÃ³n Apache
# ----------------------------
RUN echo "" \
    && echo "=> ğŸ”§ Configurando Apache..." \
    && sed -i 's/AllowOverride None/AllowOverride All/' /etc/apache2/apache2.conf \
    && echo "ServerName localhost" >> /etc/apache2/apache2.conf \
    && echo "" \
    && echo "âœ” Apache configurado âœ…" \
    && echo ""

# ----------------------------
# ğŸ“„ Copiar configuraciÃ³n y cÃ³digo
# ----------------------------
RUN echo "" \
    && echo "=> ğŸ“„ Copiando apache.conf..."
COPY apache.conf /etc/apache2/sites-available/000-default.conf

RUN echo "" \
    && echo "=> ğŸ“„ Copiando cÃ³digo fuente..."
WORKDIR /var/www/html
COPY . /var/www/html

# ----------------------------
# ğŸ”‘ Configurar permisos
# ----------------------------
RUN echo "" \
    && echo "=> ğŸ”‘ Ajustando permisos..." \
    && chown -R www-data:www-data /var/www/html \
    && chmod -R 755 /var/www/html \
    && echo "" \
    && echo "âœ” Permisos configurados âœ…" \
    && echo ""

# ----------------------------
# ğŸŒ Exponer puerto
# ----------------------------
EXPOSE 80

# ----------------------------
# âœ… Resumen Build Backend
# ----------------------------
RUN echo "" \
    && echo "===== Backend Build Completo! =====" \
    && echo "" \
    && echo "âœ” PHP y extensiones instaladas" \
    && echo "âœ” Apache configurado" \
    && echo "âœ” CÃ³digo copiado y permisos ajustados" \
    && echo "ğŸŒ URL de acceso: http://localhost:8081 (backend)" \
    && echo ""

CMD ["apache2-foreground"]

